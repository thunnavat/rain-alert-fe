<script setup>
import { ref, onMounted } from "vue"
import BtnComponent from "../components/BtnComponent.vue"
import { userSubscribe } from "../store/userData.js"
import { UserDataApi } from "../util/utils"
import router from "../router"

localStorage.setItem("page", "Subscribe")
const selectedDistrict = ref("")

const isZoom = ref(false)
const storeProvince = userSubscribe()
const isLoggedIn = !(UserDataApi.getDistrict() == "Not Logged In Yet")

onMounted(() => {
  UserDataApi.getDistrict()
})

// UserDataApi.getDistrict()
function navigateToLogin() {
  router.push({name: "Login"})
}

function setProvinces(name) {
  if (storeProvince.provinces.includes(name)) {
    storeProvince.removeProvince(name)
    UserDataApi.setDistrict()
  } else if (storeProvince.provinces.includes(name) == false) {
    storeProvince.setProvince(name)
    UserDataApi.setDistrict()
  }
}

const districts = [
  {
    name: "Nong Khaem",
    coords:
      "22,684,24,723,22,838,29,861,31,901,42,969,142,960,119,901,201,890,268,899,332,910,354,754,352,689"
  },
  {
    name: "Thawi Wattana",
    coords:
      "47,973,58,1070,38,1077,39,1100,31,1116,50,1210,75,1273,64,1309,111,1303,146,1281,250,1234,239,1158,143,957"
  },
  {
    name: "Bang Bon",
    coords:
      "69,1311,64,1358,89,1384,132,1366,152,1399,205,1470,508,1199,464,1149,270,1251,250,1237,152,1281,108,1303"
  },
  {
    name: "Bang Khun Thian",
    coords:
      "206,1476,230,1517,239,1583,255,1599,272,1657,296,1723,379,1706,379,1747,403,1789,370,1830,337,1912,346,1994,543,1970,502,1780,510,1607,535,1525,584,1533,601,1574,617,1574,642,1517,650,1476,609,1451,626,1435,617,1336,584,1327,519,1303,527,1237,510,1204"
  },
  {
    name: "Taling Chan",
    coords:
      "356,689,356,748,333,908,382,911,433,937,459,945,515,945,545,930,574,934,571,893,541,841,537,811,563,778,593,774,589,745,600,741,589,730,600,741,600,715,563,700"
  },
  {
    name: "Bang Khae",
    coords:
      "119,900,241,1167,241,1193,252,1215,252,1237,267,1252,426,1166,415,989,385,989,382,967,367,948,367,915,259,900,182,889"
  },
  {
    name: "Phasi Charoen",
    coords:
      "367,911,370,948,385,960,389,989,415,986,422,1156,430,1167,467,1149,456,1111,474,1082,519,1097,526,1078,545,1078,567,1071,571,1048,593,1048,608,1026,571,986,567,930,545,930,504,945,448,945"
  },
  {
    name: "Chom Thong",
    coords:
      "471,1084,456,1132,500,1188,511,1225,526,1232,526,1277,519,1303,571,1314,589,1336,608,1332,604,1306,630,1306,626,1273,652,1269,637,1254,682,1217,674,1188,652,1169,652,1136,634,1080,611,1088,593,1069,604,1052,574,1047,567,1069,545,1073,519,1095"
  },
  {
    name: "Thung Khru",
    coords:
      "615,1343,622,1414,615,1451,645,1469,652,1495,634,1529,652,1562,663,1581,685,1592,711,1592,726,1569,745,1555,771,1558,782,1536,811,1521,815,1514,797,1495,785,1418,797,1410,800,1384,811,1377,804,1362,800,1295,763,1288,737,1292,726,1310,700,1299,689,1317,652,1310,645,1288,634,1288,622,1306,611,1310"
  },
  {
    name: "Rat Burana",
    coords:
      "630,1285,652,1289,652,1311,693,1315,704,1296,730,1311,745,1289,804,1296,797,1237,815,1226,793,1203,704,1177,686,1140,660,1140,649,1170,686,1189,671,1222,652,1244"
  },
  {
    name: "Bangkok Noi",
    coords:
      "608,748,589,748,593,777,563,781,541,807,537,848,556,866,571,896,571,925,604,933,641,918,674,911,685,837"
  },
  {
    name: "Bang Phlat",
    coords: "600,737,741,689,793,641,800,648,785,704,756,734,730,778,693,841"
  },
  {
    name: "Nong Chok",
    coords:
      "1938,138,1938,293,1956,305,1941,323,1919,356,1964,475,2004,460,1993,501,2001,519,2001,579,1978,586,1975,645,2001,653,1975,671,1952,712,1952,731,1941,753,2001,760,2027,749,2064,764,2075,786,2101,823,2134,816,2138,805,2219,805,2245,853,2241,875,2275,934,2290,938,2423,716,2493,682,2534,623,2416,519,2427,490,2393,479,2390,453,2404,431,2438,50,2327,62"
  },
  {
    name: "Khlong Sam Wa",
    coords:
      "1508,179,1508,201,1489,212,1530,279,1526,327,1515,353,1497,379,1497,408,1482,442,1437,464,1500,490,1515,549,1545,590,1549,623,1586,608,1586,597,1626,601,1623,560,1645,564,1645,534,1656,534,1667,568,1682,564,1686,538,1712,531,1741,542,1749,586,1756,586,1763,594,1964,475,1923,353,1960,308,1941,301,1941,142,1626,179"
  },
  {
    name: "Min Buri",
    coords:
      "1545,626,1586,604,1589,593,1626,600,1623,563,1641,563,1641,537,1656,537,1656,563,1682,559,1682,537,1715,526,1741,545,1749,585,1763,593,2001,459,2008,474,1993,504,2008,522,1997,585,1971,604,1982,648,1997,652,1964,682,1960,719,1934,708,1912,693,1897,711,1889,760,1841,767,1815,778,1812,793,1793,797,1786,782,1756,782,1756,808,1723,808,1719,782,1712,785,1704,793,1667,793,1649,782,1634,785,1589,700,1567,671,1571,648"
  },
  {
    name: "Lat Krabang",
    coords:
      "1626,782,1645,778,1675,793,1704,793,1712,782,1726,782,1726,804,1752,808,1752,782,1786,782,1804,789,1834,763,1886,760,1904,697,1923,685,1926,701,1956,711,1949,737,1952,752,2008,760,2034,752,2067,767,2067,778,2093,800,2101,815,2127,819,2138,808,2215,804,2238,826,2241,863,2253,893,2275,934,2286,948,2193,1100,2215,1115,2215,1145,1930,1034,1856,1031,1841,1031,1697,1034,1689,1019,1604,1030,1593,982,1600,888,1586,873,1630,802"
  },
  {
    name: "Sai Mai",
    coords:
      "1252,127,1311,127,1319,142,1515,145,1512,197,1493,212,1526,275,1523,342,1497,375,1456,356,1415,349,1404,360,1378,349,1378,342,1323,342,1326,330,1293,334,1245,342,1208,327,1189,327,1193,297,1186,282,1256,167"
  },
  {
    name: "Bang Khen",
    coords:
      "1186,277,1197,296,1189,322,1249,340,1278,329,1286,333,1326,329,1323,344,1378,340,1374,351,1404,362,1415,348,1437,355,1452,355,1475,351,1497,377,1500,407,1486,433,1460,451,1441,448,1419,455,1415,466,1408,462,1397,485,1326,488,1304,503,1289,514,1267,511,1230,485,1174,485,1163,496,1104,503,1093,444,1097,348,1134,307"
  },
  {
    name: "Khan Na Yao",
    coords:
      "1349,498,1400,487,1400,453,1415,461,1437,450,1460,450,1441,468,1471,476,1500,487,1519,550,1549,594,1549,628,1571,650,1563,672,1586,694,1456,768,1445,750,1460,746,1434,672,1426,672,1419,654,1415,650,1393,594,1408,583,1404,568,1389,561,1386,542,1349,550"
  },
  {
    name: "Bueng Kum",
    coords:
      "1345,490,1319,490,1297,512,1256,608,1274,616,1286,653,1311,679,1311,727,1337,760,1349,757,1374,816,1415,797,1460,768,1452,753,1460,745,1452,705,1430,668,1423,668,1393,601,1400,579,1397,556,1382,534,1349,549,1349,516"
  },
  {
    name: "Saphan Sung",
    coords:
      "1415,800,1471,759,1589,696,1630,781,1623,807,1586,870,1600,872,1593,977,1389,951,1412,929,1423,911,1467,900,1467,888,1430,870,1430,829"
  },
  {
    name: "Prawet",
    coords:
      "1393,952,1500,967,1593,974,1623,1100,1608,1115,1604,1152,1589,1200,1586,1223,1563,1267,1560,1293,1441,1256,1415,1230,1400,1234,1386,1230,1378,1256,1341,1249,1319,1215,1311,1145,1289,1115,1360,1104,1356,1067,1360,1063,1363,1041,1334,1041,1326,1011,1345,997,1363,997"
  },
  {
    name: "Bang Na",
    coords:
      "1378,1249,1360,1297,1367,1323,1330,1312,1300,1330,1245,1319,1223,1300,1211,1312,1178,1308,1167,1297,1160,1304,1145,1282,1111,1267,1104,1267,1078,1249,1104,1226,1111,1197,1167,1204,1193,1197,1200,1182,1241,1189,1256,1212,1315,1215,1341,1249"
  },
  {
    name: "Phra Khanong",
    coords:
      "1104,1139,1152,1102,1215,1087,1226,1098,1274,1094,1311,1143,1315,1183,1326,1217,1267,1213,1241,1187,1193,1191,1186,1202,1145,1206,1119,1198,1123,1161"
  },
  {
    name: "Suan Luang",
    coords:
      "1293,1113,1341,1102,1356,1102,1356,1065,1363,1061,1363,1043,1334,1043,1326,1020,1345,998,1363,994,1386,965,1400,957,1337,939,1341,924,1319,917,1308,909,1293,902,1200,931,1152,913,1137,939,1137,954,1167,957,1174,1035,1182,1039,1178,1057,1163,1065,1178,1094,1215,1091,1249,1098,1267,1094"
  },
  {
    name: "Bang Kapi",
    coords:
      "1389,951,1412,933,1419,911,1467,900,1471,888,1430,870,1430,825,1412,800,1374,811,1349,755,1315,729,1311,674,1278,640,1274,611,1260,611,1256,622,1245,622,1223,662,1215,696,1241,688,1271,844,1215,851,1156,896,1148,914,1193,929,1289,903,1311,914,1337,918,1341,940"
  },
  {
    name: "Lat Phrao",
    coords:
      "1208,692,1245,618,1252,622,1293,507,1263,511,1230,488,1193,485,1171,488,1160,496,1137,496,1108,507,1100,633,1100,662,1100,677,1141,688"
  },
  {
    name: "Wang Thonglang",
    coords:
      "1104,679,1134,690,1215,694,1215,701,1241,697,1271,845,1219,849,1156,897,1123,857,1111,820,1119,790,1100,749,1100,701"
  },
  {
    name: "Don Mueang",
    coords:
      "1241,67,1223,50,1167,47,1174,91,1119,62,1085,58,1048,47,1019,54,978,217,1000,221,1019,239,1100,269,1078,310,1119,325,1186,276,1260,158,1249,116"
  },
  {
    name: "Lak Si",
    coords:
      "982,216,1004,220,1008,235,1097,272,1082,313,1123,324,1100,353,1093,390,1097,453,1052,450,1000,457,919,483"
  },
  {
    name: "Chatuchak",
    coords:
      "919,480,993,454,1093,443,1100,491,1108,506,1104,632,1100,654,1104,680,1071,677,1045,684,1015,691,1015,714,885,699,922,617,915,602,889,602,889,584"
  },
  {
    name: "Bang Sue",
    coords:
      "915,486,885,601,922,608,926,619,885,701,867,697,856,701,811,694,819,660,815,638,763,616,774,590,789,586,852,531"
  },
  {
    name: "Dusit",
    coords:
      "811,694,793,735,763,765,748,787,741,817,774,850,811,887,889,702,852,702"
  },
  {
    name: "Phra Nakhon",
    coords:
      "741,814,719,851,696,870,693,914,715,940,734,948,752,922,756,885,774,851"
  },
  {
    name: "Bang Kho Laem",
    coords:
      "774,1081,748,1114,719,1133,704,1163,748,1185,789,1185,815,1200,834,1166,867,1155,860,1122,837,1129,804,1111,800,1089"
  },
  {
    name: "Yan Nawa",
    coords:
      "856,1108,871,1160,837,1167,815,1197,874,1249,900,1252,919,1252,941,1212,941,1130,963,1093,960,1056,945,1060,937,1048,926,1071,904,1086,919,1100,897,1115,882,1104,871,1111,882,1104,871,1111"
  },
  {
    name: "Khlong Toei",
    coords:
      "1100,1137,1156,1100,1148,1081,956,940,948,948,956,1026,963,1085,1037,1100"
  },
  {
    name: "Watthana",
    coords:
      "948,938,948,912,1071,923,1137,938,1137,957,1171,957,1174,1038,1182,1042,1178,1060,1163,1060,1186,1097,1163,1097,1163,1105,1152,1086,963,945"
  },
  {
    name: "Huai Khwang",
    coords:
      "989,912,1008,845,1037,808,1037,690,1067,682,1104,682,1100,757,1119,786,1111,820,1123,845,1126,868,1152,897,1141,938,1067,923"
  },
  {
    name: "Din Daeng",
    coords:
      "982,716,989,738,967,775,941,831,908,845,948,879,1000,883,1004,845,1037,816,1037,690,1015,690,1015,716"
  },
  {
    name: "Phaya Thai",
    coords: "889,699,848,803,908,848,937,833,985,740,985,711"
  },
  {
    name: "Ratchathewi",
    coords: "845,805,948,879,997,879,989,916,904,912,904,908,830,912,811,894"
  },
  {
    name: "Pathum Wan",
    coords:
      "808,892,830,911,900,907,900,911,948,914,956,1033,915,1014,800,959,800,937,804,929"
  },
  {
    name: "Sathon",
    coords:
      "793,1047,789,1069,778,1084,804,1091,797,1106,837,1129,856,1121,852,1106,874,1106,885,1103,900,1110,915,1095,908,1080,926,1069,934,1054,941,1058,956,1062,952,1025,919,1017,897,1028,841,1040"
  },
  {
    name: "Bang Rak",
    coords:
      "797,1051,822,1047,871,1025,911,1021,915,1014,808,966,800,980,789,995,808,966"
  },
  {
    name: "Pom Prap Sattru Phai",
    coords: "800,958,804,932,811,891,778,847,763,873,752,925"
  },
  {
    name: "Samphanthawong",
    coords: "752,922,767,940,800,959,800,985,789,996,774,966,734,948"
  },
  {
    name: "Khlong San",
    coords: "722,958,704,1010,700,1058,722,1091,763,1062,782,1028,767,973"
  },
  {
    name: "Thon Buri",
    coords:
      "726,960,696,942,678,968,671,1008,648,1023,611,1020,611,1031,593,1053,600,1053,585,1075,608,1090,630,1083,645,1127,656,1138,682,1142,696,1101,719,1090,700,1057,704,1008"
  },
  {
    name: "Bangkok Yai",
    coords:
      "689,944,671,974,667,1011,641,1022,608,1022,582,996,571,963,571,929,622,929,637,911,674,914,678,918"
  }
]

const zoomBtn = {
  btnName: "Zoom Image",
  iconPath: "",
  bgColor: "#484848",
  width: "12em"
}
</script>

<template>
  <div
    v-if="isLoggedIn == true"
    class="bg-[#171717]"
  >
    <BtnComponent
      :btn-property="zoomBtn"
      @click="isZoom = !isZoom"
    />
    <p class="sticky top-0 text-2xl bg-[#171717]">
      Your Selected District Is {{ selectedDistrict ? selectedDistrict : "-" }}
    </p>
    <div
      v-show="storeProvince.provinces != ''"
      class="absolute top-1/2 h-96 overflow-y-auto px-10"
    >
      <p>Your Current Subsciption List Is</p>
      <ul
        v-for="(province, index) in storeProvince.provinces"
        :key="index"
        class=""
      >
        <li
          class="hover:cursor-pointer select-none"
          @click="setProvinces(province)"
        >
          {{ province }}
        </li>
      </ul>
    </div>
    <svg
      viewBox="0 0 2560 2034"
      :width="isZoom == true ? '100%' : '50%'"
      :height="isZoom == true ? '100%' : '50%'"
      class="zoom max-w-full"
    >
      <image
        x="0"
        y="0"
        width="100%"
        height="100%"
        xlink:href="../assets/BkMap.png"
      />
      <polygon
        v-for="(district, index) in districts"
        :key="index"
        :points="district.coords"
        fill="transparent"
        stroke-miterlimit="10"
        :class="
          storeProvince.provinces.includes(district.name) ? 'favorited' : 'poly'
        "
        @click="setProvinces(district.name)"
        @mouseenter="selectedDistrict = district.name"
        @mouseleave="selectedDistrict = ''"
      />
    </svg>
  </div>
  <div
    v-else-if="isLoggedIn == false"
    class="bg-[#171717] h-96 flex items-center justify-center"
  >
    <h1>Please 
      <span 
      class="text-blue-600 hover:cursor-pointer hover:underline"
      @click="navigateToLogin()">Log In</span>
       First</h1>
  </div>
</template>

<style scoped>
.poly {
  transition: all 0.5s;
}
.poly:hover {
  stroke: hsla(65, 100%, 50%, 0.553);
  stroke-width: 2px;
  fill: hsla(65, 100%, 50%, 0.553);
}
.zoom {
  transition-property: all;
  transition-duration: 2s;
}
.favorited {
  stroke: black;
  stroke-width: 3px;
  fill: hsl(65, 100%, 50%);
  animation-name: favorite;
  animation-duration: 1s;
  transition: all 1s;
}

@keyframes favorite {
  0% {
    stroke: black;
    stroke-width: 3px;
  }
  50% {
    stroke: black;
    stroke-width: 7px;
  }
  100% {
    stroke: black;
    stroke-width: 3px;
  }
}
</style>
